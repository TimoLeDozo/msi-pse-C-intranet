# MSI PROPALES - Configuration Cursor

## IdentitÃ© du projet
Tu travailles sur **MSI Propales**, un gÃ©nÃ©rateur de propositions commerciales IA dÃ©veloppÃ© par Tim (Ã©tudiant Icam).

## Stack technique
- Backend: Node.js 20+ / Express 5.x
- IA: DeepSeek API (deepseek-chat)
- Documents: docxtemplater + pizzip + libreoffice-convert (PDF)
- Auth: bcrypt + express-session
- Frontend: HTML/CSS/JS vanilla (Design "Neural UI" glassmorphism)

## Architecture hexagonale stricte
```
adapters/       â†’ Connexions externes (API, fichiers, DB)
usecases/       â†’ Logique mÃ©tier pure
controllers/    â†’ Orchestration requÃªte/rÃ©ponse
routes/         â†’ DÃ©finition des endpoints
services/       â†’ Utilitaires partagÃ©s
prompts/        â†’ Prompts systÃ¨me pour DeepSeek
```

### RÃ¨gle fondamentale
- **Adapters** : Uniquement I/O, aucune logique mÃ©tier
- **Usecases** : Toute la logique mÃ©tier, retournent `{ success, data, error }`
- **Controllers** : Appellent les usecases, formatent la rÃ©ponse HTTP

## Conventions de code
- ES Modules (import/export) sauf si fichier existant en CommonJS
- Async/await systÃ©matique, jamais de callbacks
- Gestion d'erreurs avec try/catch
- Commentaires en franÃ§ais
- Nommage: camelCase (variables), PascalCase (classes), SCREAMING_SNAKE (constantes)

## Fichiers critiques Ã  connaÃ®tre
- `middleware/requireAuth.js` â†’ Middleware d'authentification session
- `usecases/generateProposal.usecase.js` â†’ GÃ©nÃ©ration complÃ¨te (IA â†’ DOCX â†’ PDF)
- `usecases/previewProposal.usecase.js` â†’ Preview IA uniquement
- `adapters/ai/deepseek.adapter.js` â†’ Connecteur API DeepSeek
- `adapters/storage/docx.adapter.js` â†’ GÃ©nÃ©ration DOCX via docxtemplater
- `prompts/icam.prompt.js` â†’ System prompt pour DeepSeek

## Flux de gÃ©nÃ©ration
1. POST /api/proposal/preview â†’ previewProposal.usecase â†’ DeepSeek â†’ JSON sections
2. POST /api/proposal/generate â†’ generateProposal.usecase â†’ DOCX â†’ PDF â†’ URLs fichiers

## Commandes de dÃ©veloppement
```bash
npm run dev      # Lance le serveur (port 3000)
npm test         # Lance Jest
npm run test:watch
```

## Variables d'environnement requises
```
DEEPSEEK_API_KEY=sk-xxx
SESSION_SECRET=xxx
ADMIN_USERNAME=admin
ADMIN_PASSWORD_HASH=$2b$12$xxx
```

## Agents spÃ©cialisÃ©s (utilise selon le contexte)

### Mode ARCHITECT
Pour les questions d'architecture, structure, patterns. Propose des diagrammes Mermaid, justifie les choix techniques.

### Mode CODER
Pour l'implÃ©mentation. Code complet et fonctionnel, jamais de "// TODO" ou "...". Inclut gestion d'erreurs et commentaires franÃ§ais.

### Mode DEBUG
Pour analyser les erreurs. Format: ğŸ”´ ERREUR â†’ ğŸ“ LOCALISATION â†’ ğŸ” CAUSE â†’ âœ… SOLUTION â†’ ğŸ›¡ï¸ PRÃ‰VENTION

### Mode DOC
Pour la documentation. Swagger/OpenAPI, JSDoc, README. Exemples de requÃªtes/rÃ©ponses.

## RÃ©ponses attendues
- Code complet, pas de snippets partiels
- Toujours indiquer le chemin du fichier
- Respecter le style existant du projet
- Signaler les incohÃ©rences dÃ©tectÃ©es